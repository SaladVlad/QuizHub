# Анализа података из стека за посматрање

## Резултати стрес теста

Стрес тест је спроведен над QuizHub платформом у локалном Minikube окружењу са следећом конфигурацијом:
- **Број корисника:** 10 + 1 администратор
- **Број квизова:** 5
- **Број подношења по кориснику:** 3
- **Максимални број паралелних радника:** 5

### Резултати операција

| Операција | Успешно | Неуспешно | Успешност |
|-----------|---------|-----------|-----------|
| Регистрација корисника | 10 | 0 | 100% |
| Креирање квизова | 5 | 0 | 100% |
| Преузимање квизова | 33 | 0 | 100% |
| Подношење резултата | 33 | 0 | 100% |
| Приступ листама најбољих | 11 | 0 | 100% |

**Укупна успешност:** 100%
**Укупно време извршавања:** 7.65 секунди

### Времена одзива

| Операција | Просечно | Минимално | Максимално |
|-----------|----------|-----------|------------|
| Пријава (Login) | 519ms | 519ms | 519ms |
| Регистрација | 92ms | 30ms | 164ms |
| Креирање квиза | 962ms | 955ms | 970ms |
| Преузимање квиза | 127ms | 48ms | 277ms |
| Подношење резултата | 280ms | 106ms | 843ms |
| Листе најбољих | 161ms | 44ms | 1238ms |

## Анализа метрика из Prometheus-а

### Статус сервиса

Prometheus прикупља метрике са свих микросервиса у кластеру. Тренутни статус сервиса:

| Сервис | Статус | Инстанца | Namespace |
|--------|--------|----------|-----------|
| quiz-service | UP (1) | 10.244.0.19:80 | quizhub |
| result-service | UP (1) | 10.244.0.20:80 | quizhub |
| user-service | UP (1) | 10.244.0.18:80 | quizhub |
| gateway | UP (0)* | 10.244.0.17:80, 10.244.0.22:80 | quizhub |
| prometheus | UP (1) | localhost:9090 | observability |

*Gateway враћа статус 0 јер `/metrics` endpoint није дефинисан у Ocelot рутама, али сервис функционише исправно.

### HTTP захтеви по endpoint-у

Prometheus бележи број HTTP захтева по сваком endpoint-у и статус коду:

#### QuizService

| Endpoint | Метод | Статус код | Број захтева | Просечно време |
|----------|-------|------------|--------------|----------------|
| api/quizzes | POST | 201 (Created) | 10 | 1.875s |
| api/quizzes | POST | 403 (Forbidden) | 5 | 0.065s |
| api/quizzes/{id}/with-questions | GET | 200 (OK) | 132 | 0.044s |

#### ResultService

| Endpoint | Метод | Статус код | Број захтева | Просечно време |
|----------|-------|------------|--------------|----------------|
| api/results | POST | 201 (Created) | 66 | ~0.5s |
| api/results/leaderboard/category/{category} | GET | 200 | 10 | 0.023s |
| api/results/leaderboard/global | GET | 200 | 1 | 1.207s |

#### UserService

| Endpoint | Метод | Статус код | Број захтева | Просечно време |
|----------|-------|------------|--------------|----------------|
| api/users/auth/login | POST | 200 | 2 | 0.254s |
| api/users/auth/login | POST | 401 | 1 | 1.429s |
| api/users/auth/register | POST | 201 | 21 | ~0.1s |
| api/users/{id}/promote | PUT | 200 | 1 | 0.075s |

### Анализа перформанси

1. **Регистрација корисника** - Просечно време од 92ms је одлично за операцију која укључује хеширање лозинке (BCrypt), упис у базу и генерисање JWT токена.

2. **Креирање квизова** - Време од ~1 секунде је очекивано с обзиром на сложеност операције (креирање квиза + 5-10 питања + 4 одговора по питању = 20-40 записа у базу).

3. **Преузимање квизова** - Просечно време од 127ms показује добру оптимизацију Entity Framework упита.

4. **Подношење резултата** - Време од 280ms укључује валидацију одговора, израчунавање резултата и упис у базу.

## Дистрибуирано праћење са Jaeger-ом

Jaeger прикупља дистрибуиране трагове (traces) из свих микросервиса. Тренутно су регистрована 4 сервиса:

1. **gateway-service** - API Gateway
2. **user-service** - Сервис за управљање корисницима
3. **quiz-service** - Сервис за управљање квизовима
4. **result-service** - Сервис за резултате

### Пример трага: Приступ листи најбољих

Анализа једног трага за GET `/api/results/leaderboard/category/General%20Knowledge`:

```
TraceID: cc381daf3529de8a39b411350c4f4382

┌─────────────────────────────────────────────────────────────────────┐
│ gateway-service: GET /api/results/leaderboard/category/{category}  │
│ Трајање: 35.357ms                                                   │
│ └──> result-service: GET api/results/leaderboard/category/{category}│
│      Трајање: 21.165ms                                              │
│      └──> ResultDb: SQL Query                                       │
│           Трајање: 1.498ms                                          │
│           Query: SELECT [r].[Id], [r].[CompletedAt], ...            │
└─────────────────────────────────────────────────────────────────────┘
```

### Кључни увиди из трагова

1. **Пропагација контекста** - TraceID се успешно преноси кроз све сервисе
2. **SQL упити** - Сви упити ка бази су записани са пуним SQL текстом
3. **HTTP метаподаци** - Сваки span садржи:
   - HTTP метод и путању
   - Статус код одговора
   - User-Agent клијента
   - Време трајања

## Централизовано логовање са ELK стеком

### Статистика индекса у Elasticsearch-у

| Индекс | Број докумената | Величина |
|--------|----------------|----------|
| logs-quizhub-gateway | 5,485 | 1.3 MB |
| logs-quizhub-quiz-service | 202 | 345.9 KB |
| logs-quizhub-user-service | 162 | 310.5 KB |
| logs-quizhub-result-service | 246 | 106.8 KB |
| logs-quizhub-unknown | 42 | 38 KB |

**Укупно:** 6,137 логова у ~2.1 MB

### Структура лог записа

Filebeat прикупља логове из свих контејнера и обогаћује их метаподацима:

```json
{
  "@timestamp": "2026-01-15T20:57:09.754Z",
  "service": {
    "name": "gateway"
  },
  "severity": "inf",
  "message": "[INF] [Gateway] [Program] Gateway Request Started: dae22939-07dc-4a50-91c0-3dfbd135f65a GET /metrics from ::ffff:10.244.0.26",
  "agent": {
    "name": "filebeat-n4nq9",
    "type": "filebeat",
    "version": "8.11.0"
  },
  "host": {
    "name": "filebeat-n4nq9"
  }
}
```

### Нивои логова

- **INF (Information)** - Стандардни информативни логови (захтеви, одговори)
- **WRN (Warning)** - Упозорења (нпр. непронађене руте, неовлашћени приступ)
- **ERR (Error)** - Грешке у обради захтева

## Закључак анализе

Стек за посматрање успешно прикупља и агрегира податке из свих компоненти система:

1. **Prometheus** - Прикупља метрике о:
   - Броју HTTP захтева по endpoint-у и статус коду
   - Временима одзива (хистограм)
   - Статусу сервиса

2. **Jaeger** - Омогућава:
   - Праћење захтева кроз све микросервисе
   - Идентификацију уских грла
   - Анализу SQL упита
   - Корелацију грешака

3. **ELK Stack** - Обезбеђује:
   - Централизовано складиштење логова
   - Претраживање и филтрирање
   - Визуализацију путем Kibana-е

Ови подаци потврђују да је имплементирани стек за посматрање функционалан и способан да подржи развој, дијагностику и оптимизацију микросервисне архитектуре.

---

*Анализа спроведена: 15. јануар 2026.*
*Окружење: Minikube v1.37.0, Kubernetes v1.34.0*
*Алати: Prometheus, Grafana, Jaeger, Elasticsearch 8.11.0, Kibana 8.11.0, Filebeat 8.11.0*
